<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usuarios Conectados</title>
</head>
<body>
    <label for="selectUsuarios">Amigos Conectadoss:</label>
    <select id="selectUsuarios" onchange="establecerChat()">
        <option value="" disabled selected>Selecciona un amigo</option>
    </select>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script>

  const socket = io(`localhost:3000`);

    document.addEventListener('DOMContentLoaded', async () => {
            const usuarios = await obtenerUsuariosConectados();
            console.log(usuarios);
            llenarMenuDesplegable(usuarios);
        });
        async function obtenerUsuariosConectados() {
            return new Promise(resolve => {
                socket.emit('verAmigos', (usuarios) => {
                    resolve(usuarios);
                });
            });
        }

        function llenarMenuDesplegable(usuarios) {
            const selectUsuarios = document.getElementById('selectUsuarios');

            usuarios.forEach(usuario => {
                const opcionUsuario = document.createElement('option');
                opcionUsuario.value = usuario.id;
                opcionUsuario.textContent = usuario.usuario2;
                selectUsuarios.appendChild(opcionUsuario);
            });
        }

        function establecerChat() {
            const usuarioId = document.getElementById('selectUsuarios').value;
            if (usuarioId) {
                console.log(`Chat con el usuario ${usuarioId}`);
                // Puedes llamar a funciones adicionales para manejar el chat en el frontend
            } else {
                console.log("Selecciona un amigo para iniciar el chat.");
            }
        }
    
        
        
    </script>


</body>
</html>